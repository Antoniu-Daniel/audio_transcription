<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Transcription Service</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-2xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Audio Transcription Service</h1>
            <p class="text-gray-600">Upload your audio file to get started</p>
        </header>

        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="language">
                    Select Language
                </label>
                <select id="language" 
                    class="w-full p-2 border rounded-lg mb-4 focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                    <option value="en">English</option>
                    <option value="ro">Română</option>
                </select>

                <label class="block text-gray-700 text-sm font-bold mb-2" for="modelSize">
                    Select Model Size
                </label>
                <select id="modelSize" 
                    class="w-full p-2 border rounded-lg mb-4 focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
                    <option value="tiny">Tiny</option>
                    <option value="small">Small</option>
                    <option value="medium">Medium</option>
                    <option value="large">Large</option>
                </select>

                <input type="file" 
                    id="audioFile" 
                    accept=".mp3,.wav,.m4a"
                    class="hidden"
                    onchange="handleFileSelect(event)">
                <label for="audioFile" 
                    class="block w-full p-4 text-center border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:border-blue-500 transition-colors">
                    <span id="fileLabel" class="text-gray-600">
                        Click to select audio file (MP3, WAV, M4A)
                    </span>
                </label>
            </div>

            <button onclick="uploadFile()" 
                id="uploadButton"
                disabled
                class="w-full bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors">
                Upload and Transcribe
            </button>
        </div>

        <div id="status" class="hidden bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-2">Transcription Status</h2>
            <div class="flex items-center mb-4">
                <div id="statusIndicator" class="w-3 h-3 rounded-full mr-2"></div>
                <span id="statusText" class="text-gray-700"></span>
            </div>
            <div id="timer"></div>
            <div id="transcriptionResult" class="hidden">
                <h3 class="font-semibold mb-2">Transcription:</h3>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <p id="transcriptionText" class="text-gray-700 whitespace-pre-wrap"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedFile = null;
        const API_URL = 'http://localhost:8000';
        const timerElement = document.getElementById("timer");
        let date0;

        function handleFileSelect(event) {
            selectedFile = event.target.files[0];
            document.getElementById('fileLabel').textContent = selectedFile ? selectedFile.name : 'Click to select audio file';
            document.getElementById('uploadButton').disabled = !selectedFile;
        }

        async function uploadFile() {
            if (!selectedFile) return;

            const formData = new FormData();
            formData.append('file', selectedFile);

            timerElement.innerHTML = `0s`;
            date0 = new Date();
            const language = document.getElementById('language').value;
            const modelSize = document.getElementById('modelSize').value;

            try {
                document.getElementById('uploadButton').disabled = true;
                document.getElementById('status').classList.remove('hidden');
                updateStatus('processing', 'Transcribing audio...');

                const response = await fetch(`${API_URL}/transcribe?language=${language}&model_size=${modelSize}`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                // Calculate elapsed time
                const timer = Math.round((new Date() - date0) / 1000);
                const minutes = Math.floor(timer / 60);
                const seconds = timer % 60;
                timerElement.innerHTML = `${minutes}m ${seconds}s`;

                // Show results
                updateStatus('completed', 'Transcription completed');
                showTranscription(data.text);
            } catch (error) {
                console.error('Transcription error:', error);
                updateStatus('error', 'Error transcribing audio: ' + error.message);
            } finally {
                document.getElementById('uploadButton').disabled = false;
            }
        }

        function updateStatus(status, message) {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');

            const colors = {
                processing: 'bg-yellow-500',
                completed: 'bg-green-500',
                error: 'bg-red-500'
            };

            indicator.className = `w-3 h-3 rounded-full mr-2 ${colors[status]}`;
            statusText.textContent = message;
        }

        function showTranscription(text) {
            const resultDiv = document.getElementById('transcriptionResult');
            const textElement = document.getElementById('transcriptionText');
            resultDiv.classList.remove('hidden');
            textElement.textContent = text;
        }
    </script>
</body>
</html>